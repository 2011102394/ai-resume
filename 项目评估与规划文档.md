# AI简历助手小程序 - 项目评估与规划文档

> 文档生成时间：2026年2月6日
> 项目名称：简历点睛 (ai-resume)
> AppID：wxf18dce92c195a6a3
> 当前版本：v0.7.0

---

## 📋 目录

1. [项目概述](#项目概述)
2. [当前实现功能清单](#当前实现功能清单)
3. [项目规划与现状对比](#项目规划与现状对比)
4. [功能缺失分析](#功能缺失分析)
5. [待实现功能优先级](#待实现功能优先级)
6. [数据库设计建议](#数据库设计建议)
7. [技术架构优化建议](#技术架构优化建议)
8. [开发计划建议](#开发计划建议)

---

## 项目概述

### 你的原始计划

1. **技术栈**：微信小程序云开发
2. **AI能力**：腾讯混元大模型（参加腾讯AI小程序成长计划，1亿token免费额度）
3. **使用限制**：
   - 用户每天3次免费润色机会
   - 用完后可看广告获取额外机会
   - 一天最多10次（免费+广告）
   - 24小时后重置
4. **历史记录**：登录后可查看最近30天的记录

### 项目当前状态

**整体完成度：35-40%**

核心的AI简历优化功能已实现，但**商业化关键功能全部缺失**：
- ❌ 无用户登录系统
- ❌ 无次数限制机制
- ❌ 无广告系统
- ❌ 无历史记录功能

项目目前是一个"能跑的MVP"，但距离可商业化的产品还有较大差距。

---

## 当前实现功能清单

### ✅ 已完全实现（70%）

#### 1. AI简历优化核心
- **功能描述**：使用腾讯混元大模型优化工作经历描述
- **实现方式**：
  - 云函数：`cloudfunctions/optimizeResume`
  - 模型：`hunyuan-turbos-latest`
  - 调用方式：OpenAI兼容接口
  - 超时配置：60秒
- **优化风格**：
  - 数据突出型（150-200字，强化量化指标）
  - 领导力凸显型（150-200字，突出领导能力）
  - 简洁通用型（100-150字，精炼语言）
- **降级策略**：API调用失败时使用模拟优化
- **完成度**：100%

#### 2. AI参考示例生成
- **功能描述**：根据职业、年限、岗位生成STAR法则示例
- **实现方式**：
  - 云函数：`cloudfunctions/generateExample`
  - 模型：`hunyuan-turbos-latest`
- **支持维度**：
  - 预设职业分类：技术研发、产品设计、运营市场、销售商务、人力资源、财务会计
  - 工作年限：1-3年（初级）、3-5年（中级）、5-10年（高级）、10年以上（专家）
  - 自定义职业：用户可添加自定义职业分类
- **智能适配**：根据岗位关键词生成更贴合的示例
- **完成度**：100%

#### 3. 职业分类管理
- **功能描述**：预设+自定义职业分类
- **云函数**：
  - `cloudfunctions/getCategories`：获取分类列表
  - `cloudfunctions/saveCustomCategory`：保存自定义分类
- **数据存储**：
  - 集合：`user_custom_categories`
  - 用户隔离：基于 `openid` 自动隔离
- **完成度**：100%

#### 4. 用户登录基础
- **功能描述**：登录云函数获取用户openid
- **云函数**：`cloudfunctions/login`
- **返回数据**：`openid`, `appid`, `unionid`
- **问题**：前端未调用，没有登录流程
- **完成度**：20%（仅云函数实现）

#### 5. UI/UX设计
- **功能描述**：精美的渐变背景、卡片式布局、流畅动画
- **实现细节**：
  - 品牌头部：品牌图标 + 更多按钮（未绑定功能）
  - 打字机动画：标题 "为你的工作经历画龙点睛" 动态循环播放
  - 输入区：多行文本输入，最多2000字，自动高度调整
  - 复制功能：复制到剪贴板，成功反馈（2秒恢复）
  - 加载状态：优化中显示加载提示
- **完成度**：90%

---

### ⚠️ 部分实现（30-60%）

#### 6. 前端页面
- **完成度**：50%
- **已实现**：
  - 首页完整交互
  - 参考示例弹窗
  - 三种优化风格选择
- **未实现**：
  - 历史记录页面
  - 用户中心页面
  - 设置页面
  - 详情页面

#### 7. 错误处理
- **完成度**：60%
- **已实现**：
  - 空输入验证
  - 参数验证
  - 网络错误提示
- **未实现**：
  - API限流处理
  - 广告加载失败处理
  - 用户友好错误引导

---

### ❌ 未实现（0%）

#### 8. 次数限制系统
- **需求**：
  - 每天免费3次
  - 看广告获取额外机会
  - 每天最多10次
  - 24小时后重置
- **实现状态**：完全未实现
- **影响**：商业化基础缺失

#### 9. 广告系统
- **需求**：激励视频广告
- **实现状态**：完全未实现
- **影响**：无法获取额外使用次数

#### 10. 历史记录系统
- **需求**：查看最近30天的优化记录
- **实现状态**：完全未实现
- **影响**：用户体验差，无法追溯历史

#### 11. 用户管理系统
- **需求**：登录、个人信息展示、多端同步
- **实现状态**：仅云函数实现，前端未集成
- **影响**：无法关联用户数据

---

## 项目规划与现状对比

### 你的计划 vs 实际实现

| 计划功能 | 计划内容 | 实际实现 | 差距 |
|---------|---------|---------|------|
| **技术栈** | 微信小程序云开发 | ✅ 已实现 | - |
| **AI能力** | 腾讯混元大模型（1亿token） | ✅ 已集成 | ✅ 完美 |
| **免费限制** | 每天3次免费润色 | ❌ 未实现 | 🔴 严重缺失 |
| **广告次数** | 看广告获取额外机会 | ❌ 未实现 | 🔴 严重缺失 |
| **每日上限** | 最多10次（免费+广告） | ❌ 未实现 | 🔴 严重缺失 |
| **重置机制** | 24小时后重置 | ❌ 未实现 | 🔴 严重缺失 |
| **历史记录** | 查看30天记录 | ❌ 未实现 | 🔴 严重缺失 |
| **用户登录** | 登录后查看记录 | ⚠️ 20% | 🟡 部分实现 |

### 核心问题总结

**商业化功能全部缺失**
- 无法控制使用次数（无限免费使用）
- 无法通过广告获取收益
- 无法培养用户付费习惯
- 无法追踪用户行为

**用户体验不完整**
- 刷新页面后内容丢失
- 无法查看历史优化记录
- 无法对比优化效果
- 只能处理单段工作经历

---

## 功能缺失分析

### 🔴 P0：商业化和体验核心功能

#### 1. 次数限制系统

**重要性**：⭐⭐⭐⭐⭐（最高）

**缺失原因**：未设计数据库、未实现计数逻辑、无重置机制

**实现难度**：中等（1-2天）

**技术方案**：
```javascript
// 数据库设计
// users 集合
{
  _openid: String,           // 用户标识
  freeQuota: Number,        // 当天免费配额（初始3）
  adQuota: Number,          // 当天广告配额（初始0）
  totalUsed: Number,        // 当天已使用次数
  lastResetDate: String,    // 上次重置日期
  totalUsed: Number,        // 累计使用次数
}

// usage_logs 集合
{
  _openid: String,
  action: String,          // optimize/generateExample
  type: String,            // free/ad
  timestamp: Date
}
```

**业务逻辑**：
1. 每次调用前检查配额
2. 判断是否超过24小时，自动重置
3. 免费次数用完，提示看广告
4. 每天最多10次（3免费+7广告）

---

#### 2. 广告系统集成

**重要性**：⭐⭐⭐⭐⭐（最高）

**缺失原因**：未申请广告位、未集成广告SDK、无奖励逻辑

**实现难度**：中等（1-2天）

**技术方案**：
```javascript
// 1. 申请广告位
// 在微信公众平台申请激励视频广告单元

// 2. 前端集成广告
const rewardedVideoAd = wx.createRewardedVideoAd({
  adUnitId: 'adunit-xxxxx'
})

// 3. 广告监听
rewardedVideoAd.onClose((res) => {
  if (res.isEnded) {
    // 用户看完广告，增加配额
    wx.cloud.callFunction({
      name: 'increaseQuotaByAd'
    })
  }
})
```

**注意事项**：
- 广告单元ID需要在微信公众平台申请
- 需要处理广告加载失败的情况
- 需要防止广告滥用（用户刷广告）

---

#### 3. 历史记录功能

**重要性**：⭐⭐⭐⭐⭐（最高）

**缺失原因**：未设计数据库、未实现查询逻辑、无列表UI

**实现难度**：中等（1-2天）

**技术方案**：
```javascript
// 数据库设计
// history_records 集合
{
  _openid: String,
  originalContent: String,    // 原始内容
  optimizedContent: String,   // 优化后内容
  style: String,             // 优化风格
  modelName: String,         // 模型名称
  createTime: Date,
  updateTime: Date
}

// 查询最近30天的记录
const db = wx.cloud.database()
db.collection('history_records')
  .where({
    _openid: '{openid}',
    createTime: _.gte(new Date(Date.now() - 30 * 24 * 60 * 60 * 1000))
  })
  .orderBy('createTime', 'desc')
  .limit(50)
  .get()
```

**UI设计**：
- 历史记录列表页
- 点击记录恢复到输入框
- 删除单条记录
- 清空所有记录

---

#### 4. 用户登录系统

**重要性**：⭐⭐⭐⭐

**缺失原因**：前端未集成、无登录UI、无状态管理

**实现难度**：简单（0.5-1天）

**技术方案**：
```javascript
// 前端调用登录
wx.cloud.callFunction({
  name: 'login'
}).then(res => {
  // 保存openid到全局状态
  app.globalData.openid = res.result.openid
  // 保存到本地存储
  wx.setStorageSync('openid', res.result.openid)
})

// 检查登录状态
app.checkLogin = function() {
  const openid = wx.getStorageSync('openid')
  if (openid) {
    return true
  }
  // 跳转到登录页
  wx.redirectTo({ url: '/pages/login/login' })
}
```

---

### 🟡 P1：重要体验功能

#### 5. 优化前后对比

**重要性**：⭐⭐⭐⭐

**缺失原因**：未设计diff算法、无对比UI

**实现难度**：中等（1.5-2天）

**价值**：让用户看到AI的优化效果，建立信任

---

#### 6. 多段工作经历处理

**重要性**：⭐⭐⭐⭐

**缺失原因**：UI设计为单段、数据结构不支持

**实现难度**：较大（2-3天）

**价值**：实际简历有3-5段工作经历，这是实际使用痛点

---

#### 7. 撤销/重做功能

**重要性**：⭐⭐⭐

**缺失原因**：未设计栈结构、无状态管理

**实现难度**：简单（0.5-1天）

**价值**：提升容错能力

---

### 🟢 P2：增强功能

#### 8. 导出功能
- 导出为PDF、Word、长图
- 实现难度：2-3天
- 价值：高

#### 9. 保存草稿
- 自动保存到本地，意外关闭可恢复
- 实现难度：0.5-1天
- 价值：中

#### 10. 优化进度条
- 显示AI思考进度
- 实现难度：0.5天
- 价值：低

---

## 待实现功能优先级

### 第一阶段：商业化基础（1-2周）🔴 P0

| 优先级 | 功能 | 工作量 | 价值 | 建议实现顺序 |
|-------|------|--------|------|------------|
| 1 | 用户登录系统 | 0.5-1天 | ⭐⭐⭐⭐ | 1️⃣ 先做 |
| 2 | 次数限制系统 | 1-2天 | ⭐⭐⭐⭐⭐ | 2️⃣ 核心商业逻辑 |
| 3 | 广告系统集成 | 1-2天 | ⭐⭐⭐⭐⭐ | 3️⃣ 获取收益 |
| 4 | 历史记录功能 | 1-2天 | ⭐⭐⭐⭐⭐ | 4️⃣ 用户体验 |

**完成后的效果**：
- ✅ 商业化闭环：用户使用 → 次数限制 → 看广告 → 继续使用
- ✅ 用户粘性：历史记录，可追溯优化历史
- ✅ 收益渠道：广告收益

---

### 第二阶段：体验升级（1周）🟡 P1

| 优先级 | 功能 | 工作量 | 价值 | 建议实现顺序 |
|-------|------|--------|------|------------|
| 5 | 优化前后对比 | 1.5-2天 | ⭐⭐⭐⭐ | 1️⃣ |
| 6 | 多段工作经历处理 | 2-3天 | ⭐⭐⭐⭐⭐ | 2️⃣ |
| 7 | 撤销/重做功能 | 0.5-1天 | ⭐⭐⭐ | 3️⃣ |
| 8 | 保存草稿 | 0.5-1天 | ⭐⭐⭐ | 4️⃣ |

**完成后的效果**：
- ✅ 用户体验大幅提升
- ✅ 解决实际使用痛点
- ✅ 容错能力增强

---

### 第三阶段：功能增强（1-2周）🟢 P2

| 优先级 | 功能 | 工作量 | 价值 |
|-------|------|--------|------|
| 9 | 导出功能（PDF/Word/长图） | 2-3天 | ⭐⭐⭐⭐ |
| 10 | 字数统计 | 0.1天 | ⭐⭐ |
| 11 | 优化进度条 | 0.5天 | ⭐⭐ |
| 12 | 快捷操作（清空、快捷键） | 0.3天 | ⭐⭐ |
| 13 | 夜间模式 | 0.5-1天 | ⭐⭐ |

**完成后的效果**：
- ✅ 功能完整度提升
- ✅ 用户体验细节完善

---

## 数据库设计建议

### 需要新增的集合

#### 1. users（用户表）
```javascript
{
  _id: String,
  _openid: String,               // 用户openid（云开发自动）
  nickname: String,             // 昵称（可选）
  avatar: String,               // 头像URL（可选）
  phone: String,                // 手机号（可选）

  // 配额管理
  freeQuota: Number,            // 当天免费配额（默认3）
  adQuota: Number,              // 当天广告配额（默认0）
  totalUsed: Number,            // 当天已使用次数（默认0）
  lastResetDate: Date,         // 上次重置日期

  // 统计信息
  totalOptimizeCount: Number,   // 累计优化次数
  totalAdWatchCount: Number,    // 累计观看广告次数
  registerTime: Date,           // 注册时间
  lastLoginTime: Date,         // 最后登录时间

  // 用户配置
  defaultStyle: String,         // 默认优化风格
  theme: String,               // 主题（light/dark）

  createTime: Date,
  updateTime: Date
}
```

**索引**：
- `_openid`（唯一索引）
- `lastResetDate`（用于重置逻辑）

---

#### 2. usage_logs（使用日志表）
```javascript
{
  _id: String,
  _openid: String,
  action: String,              // 操作类型：optimize/generateExample
  type: String,                // 消耗类型：free/ad

  // 详细信息
  style: String,               // 优化风格
  contentLength: Number,       // 内容长度
  modelName: String,           // 使用的模型

  // 统计信息
  tokenUsed: Number,           // 消耗的token数（可选）

  createTime: Date
}
```

**索引**：
- `_openid` + `createTime`（查询用户使用记录）
- `createTime`（全局统计）

---

#### 3. history_records（历史记录表）
```javascript
{
  _id: String,
  _openid: String,

  // 内容
  originalContent: String,      // 原始内容
  optimizedContent: String,     // 优化后内容

  // 配置
  style: String,               // 优化风格：data/leadership/concise
  styleName: String,           // 优化风格名称
  modelName: String,           // 模型名称

  // 元数据
  contentLength: Number,       // 原始内容长度
  optimizedLength: Number,     // 优化后内容长度
  improvementRate: Number,     // 优化幅度（百分比）

  createTime: Date,
  updateTime: Date
}
```

**索引**：
- `_openid` + `createTime`（查询用户历史记录，降序）
- `createTime`（用于30天过期清理）

---

#### 4. ad_logs（广告日志表）- 可选
```javascript
{
  _id: String,
  _openid: String,

  // 广告信息
  adUnitId: String,           // 广告单元ID
  adType: String,            // 广告类型：rewarded_video

  // 结果
  isEnded: Boolean,          // 是否看完广告
  rewardAmount: Number,      // 奖励次数

  // 时间
  startTime: Date,
  endTime: Date
}
```

---

### 现有集合优化

#### user_custom_categories（用户自定义分类）
**当前结构**：已完善
**建议**：无需修改

---

### 数据库安全规则

```javascript
// users 集合
{
  "read": "doc._openid == auth.openid",
  "write": "doc._openid == auth.openid"
}

// usage_logs 集合
{
  "read": "doc._openid == auth.openid",
  "write": "doc._openid == auth.openid"
}

// history_records 集合
{
  "read": "doc._openid == auth.openid",
  "write": "doc._openid == auth.openid"
}

// user_custom_categories 集合
{
  "read": "doc._openid == auth.openid",
  "write": "doc._openid == auth.openid"
}
```

---

## 技术架构优化建议

### 1. 云函数重构建议

#### 当前问题
- 云函数职责单一，但缺少统一的错误处理
- 没有统一的响应格式
- 缺少日志记录

#### 优化方案

**统一的错误处理中间件**：
```javascript
// utils/errorHandler.js
module.exports = {
  success: (data, message = 'success') => ({
    code: 0,
    data,
    message
  }),

  error: (code, message, error) => {
    console.error('[ERROR]', message, error)
    return {
      code: code || -1,
      message,
      error: error?.message || ''
    }
  },

  wrapAsync: (fn) => async (event, context) => {
    try {
      return await fn(event, context)
    } catch (err) {
      return {
        code: -1,
        message: '服务器错误',
        error: err.message
      }
    }
  }
}
```

**统一的云函数模板**：
```javascript
const { wrapAsync } = require('../../utils/errorHandler')
const cloud = require('wx-server-sdk')

cloud.init({ env: cloud.DYNAMIC_CURRENT_ENV })

exports.main = wrapAsync(async (event, context) => {
  const wxContext = cloud.getWXContext()
  const openid = wxContext.OPENID

  // 业务逻辑...
})
```

---

### 2. 前端状态管理

#### 当前问题
- 使用 `this.setData` 管理状态，容易出错
- 用户登录状态没有全局管理
- 没有状态持久化

#### 优化方案

**建议使用简单的全局状态管理**：
```javascript
// app.js
App({
  globalData: {
    openid: null,
    userInfo: null,
    userQuota: null,
    isLoggedIn: false
  },

  // 初始化
  async onLaunch() {
    await this.checkLogin()
  },

  // 检查登录状态
  async checkLogin() {
    const openid = wx.getStorageSync('openid')
    if (openid) {
      this.globalData.openid = openid
      this.globalData.isLoggedIn = true
      // 加载用户信息
      await this.loadUserInfo()
    }
  },

  // 登录
  async login() {
    const res = await wx.cloud.callFunction({ name: 'login' })
    const openid = res.result.openid

    this.globalData.openid = openid
    this.globalData.isLoggedIn = true
    wx.setStorageSync('openid', openid)

    return openid
  },

  // 退出登录
  logout() {
    this.globalData.openid = null
    this.globalData.userInfo = null
    this.globalData.isLoggedIn = false
    wx.removeStorageSync('openid')
  }
})
```

---

### 3. API调用优化

#### 当前问题
- 每次调用都重复写 `wx.cloud.callFunction`
- 没有统一的错误处理
- 没有请求拦截

#### 优化方案

**封装API调用**：
```javascript
// utils/api.js
const api = {
  // 调用云函数
  async callFunction(name, data, options = {}) {
    const { timeout = 60000 } = options

    try {
      const res = await wx.cloud.callFunction({
        name,
        data,
        timeout
      })

      if (res.result.code === 0) {
        return res.result.data
      } else {
        wx.showToast({
          title: res.result.message || '请求失败',
          icon: 'none'
        })
        throw new Error(res.result.message)
      }
    } catch (err) {
      console.error('[API ERROR]', name, err)
      wx.showToast({
        title: '网络错误，请重试',
        icon: 'none'
      })
      throw err
    }
  },

  // 业务API
  optimizeResume(content, style) {
    return this.callFunction('optimizeResume', { content, style })
  },

  generateExample(category, experience, position) {
    return this.callFunction('generateExample', { category, experience, position })
  },

  // ... 其他API
}

module.exports = api
```

---

### 4. 混元大模型调用优化

#### 当前问题
- 没有token消耗统计
- 没有调用限流
- 错误处理不够完善

#### 优化方案

**添加token统计**：
```javascript
// 调用混元大模型
async function callHunyuan(prompt) {
  const OpenAI = require('openai')

  const client = new OpenAI({
    apiKey: OPENAI_CONFIG.apiKey,
    baseURL: OPENAI_CONFIG.baseURL
  })

  const completion = await client.chat.completions.create({
    model: 'hunyuan-turbos-latest',
    messages: [{ role: 'user', content: prompt }],
    temperature: 0.7,
    max_tokens: 2048
  })

  // 统计token消耗
  const usage = completion.usage
  console.log('[TOKEN USAGE]', {
    promptTokens: usage.prompt_tokens,
    completionTokens: usage.completion_tokens,
    totalTokens: usage.total_tokens
  })

  return {
    content: completion.choices[0].message.content,
    usage: usage
  }
}
```

---

### 5. 广告集成最佳实践

#### 申请广告位
1. 登录微信公众平台
2. 进入"流量主"页面
3. 申请激励视频广告单元
4. 获取 `adUnitId`

#### 前端集成
```javascript
// pages/index/index.js
Page({
  onLoad() {
    this.initAd()
  },

  // 初始化广告
  initAd() {
    // 创建广告实例
    this.rewardedVideoAd = wx.createRewardedVideoAd({
      adUnitId: 'adunit-xxxxx' // 替换为你的广告单元ID
    })

    // 监听广告关闭
    this.rewardedVideoAd.onClose((res) => {
      if (res.isEnded) {
        // 用户看完广告，增加配额
        this.increaseQuotaByAd()
      } else {
        // 用户未看完广告
        wx.showToast({
          title: '请看完广告才能获得奖励',
          icon: 'none'
        })
      }
    })

    // 监听广告加载错误
    this.rewardedVideoAd.onError((err) => {
      console.error('[AD ERROR]', err)
      wx.showToast({
        title: '广告加载失败',
        icon: 'none'
      })
    })
  },

  // 显示广告
  showAd() {
    this.rewardedVideoAd.show().catch(err => {
      // 广告未加载完成，先加载再显示
      this.rewardedVideoAd.load().then(() => {
        this.rewardedVideoAd.show()
      })
    })
  },

  // 通过广告增加配额
  async increaseQuotaByAd() {
    try {
      const res = await wx.cloud.callFunction({
        name: 'increaseQuotaByAd'
      })

      if (res.result.code === 0) {
        wx.showToast({
          title: `获得额外次数，今日剩余${res.result.data.remaining}次`,
          icon: 'success'
        })
      }
    } catch (err) {
      console.error('增加配额失败', err)
    }
  }
})
```

#### 云函数实现
```javascript
// cloudfunctions/increaseQuotaByAd/index.js
const cloud = require('wx-server-sdk')
cloud.init({ env: cloud.DYNAMIC_CURRENT_ENV })

const db = cloud.database()
const _ = db.command

exports.main = async (event, context) => {
  const wxContext = cloud.getWXContext()
  const openid = wxContext.OPENID

  try {
    // 检查当天总使用次数
    const user = await db.collection('users')
      .where({ _openid: openid })
      .get()

    if (!user.data || user.data.length === 0) {
      // 用户不存在，先创建
      await db.collection('users').add({
        data: {
          _openid: openid,
          freeQuota: 3,
          adQuota: 0,
          totalUsed: 0,
          lastResetDate: new Date(),
          createTime: new Date(),
          updateTime: new Date()
        }
      })
      return { code: 0, data: { remaining: 1 }, message: '首次使用' }
    }

    const userData = user.data[0]
    const now = new Date()
    const lastReset = new Date(userData.lastResetDate)

    // 检查是否需要重置
    const needReset = (now - lastReset) > 24 * 60 * 60 * 1000

    let freeQuota, adQuota, totalUsed, lastResetDate

    if (needReset) {
      // 重置配额
      freeQuota = 3
      adQuota = 0
      totalUsed = 0
      lastResetDate = now
    } else {
      freeQuota = userData.freeQuota
      adQuota = userData.adQuota
      totalUsed = userData.totalUsed
      lastResetDate = userData.lastResetDate
    }

    // 检查是否超过每天上限（3免费+7广告）
    if (totalUsed >= 10) {
      return {
        code: -1,
        message: '今日使用次数已达上限，请明天再试'
      }
    }

    // 增加广告配额
    const newAdQuota = adQuota + 1
    const newTotalUsed = totalUsed + 1

    // 更新用户数据
    await db.collection('users')
      .doc(user.data[0]._id)
      .update({
        data: {
          adQuota: newAdQuota,
          totalUsed: newTotalUsed,
          lastResetDate: lastResetDate,
          updateTime: now
        }
      })

    // 记录广告日志
    await db.collection('ad_logs').add({
      data: {
        _openid: openid,
        adUnitId: event.adUnitId,
        adType: 'rewarded_video',
        isEnded: true,
        rewardAmount: 1,
        startTime: new Date(),
        endTime: new Date()
      }
    })

    return {
      code: 0,
      data: {
        remaining: 10 - newTotalUsed
      },
      message: '获得额外次数'
    }
  } catch (err) {
    console.error('增加配额失败', err)
    return {
      code: -1,
      message: err.message || '操作失败'
    }
  }
}
```

---

## 开发计划建议

### 第1周：商业化基础 🎯

**目标**：实现完整的商业化闭环

| 天数 | 任务 | 工作量 | 产出 |
|------|------|--------|------|
| Day 1-2 | 用户登录系统 | 1天 | 登录UI、状态管理 |
| Day 3-4 | 数据库设计+次数限制 | 2天 | users表、usage_logs表、配额逻辑 |
| Day 5-6 | 广告系统集成 | 2天 | 激励视频广告、奖励逻辑 |
| Day 7 | 历史记录功能 | 1天 | history_records表、列表UI |

**里程碑**：
- ✅ 用户可以登录
- ✅ 每天免费3次，看广告获得额外次数
- ✅ 每天最多10次
- ✅ 可以查看历史记录

---

### 第2周：体验升级 🚀

**目标**：提升用户体验和功能完整性

| 天数 | 任务 | 工作量 | 产出 |
|------|------|--------|------|
| Day 8-9 | 优化前后对比 | 2天 | diff算法、对比UI |
| Day 10-12 | 多段工作经历处理 | 3天 | 卡片式UI、批量优化 |
| Day 13 | 撤销/重做 | 0.5天 | 栈结构、快捷键 |
| Day 14 | 保存草稿 | 0.5天 | 自动保存、恢复 |

**里程碑**：
- ✅ 可以看到优化前后的对比
- ✅ 可以处理多段工作经历
- ✅ 可以撤销/重做
- ✅ 意外关闭后可以恢复草稿

---

### 第3-4周：功能增强 ✨

**目标**：完善产品功能

| 任务 | 工作量 | 优先级 |
|------|--------|--------|
| 导出功能（PDF/Word/长图） | 3天 | 高 |
| 用户中心页面 | 2天 | 中 |
| 设置页面 | 1天 | 中 |
| 帮助文档 | 1天 | 低 |
| 性能优化 | 2天 | 中 |

**里程碑**：
- ✅ 可以导出简历为多种格式
- ✅ 有完整的用户中心
- ✅ 有设置和帮助页面

---

### 第5-6周：测试和优化 🧪

**目标**：确保产品质量

| 任务 | 工作量 |
|------|--------|
| 功能测试 | 2天 |
| 性能测试 | 1天 |
| 兼容性测试 | 1天 |
| 用户反馈收集 | 持续 |
| Bug修复 | 持续 |

**里程碑**：
- ✅ 核心功能稳定
- ✅ 性能优化完成
- ✅ 无严重Bug

---

## 关键注意事项

### 1. 商业化注意事项

**广告收益预估**：
- 激励视频广告单价：0.1-0.5元/次（假设）
- 每个用户每天看7次广告
- 1000个活跃用户/天：1000 × 7 × 0.3 = 2100元/天
- 月收益：2100 × 30 = 63000元/月

**成本估算**：
- 混元大模型token消耗：
  - 每次优化约1000 token
  - 每个用户每天10次：10000 token
  - 1000个用户/天：10000000 token
  - 混元价格：约0.001元/1K token
  - 成本：10000000 / 1000 × 0.001 = 10元/天
  - 月成本：10 × 30 = 300元/月

**净利润预估**：
- 63000 - 300 = 62700元/月
- 1亿token足够支持很长时间

---

### 2. 技术风险

**混元大模型API限流**：
- 建议实现调用队列
- 错误重试机制
- 降级到模拟优化

**广告加载失败**：
- 优雅降级，允许用户继续使用
- 提示用户稍后重试

**数据库性能**：
- 30天历史记录可能产生大量数据
- 建议定期清理过期数据
- 使用合适的索引

---

### 3. 合规注意事项

**隐私政策**：
- 需要告知用户数据收集和使用方式
- 获取用户授权
- 提供注销账号功能

**广告合规**：
- 遵守微信广告规范
- 不误导用户
- 不强制观看

**内容安全**：
- 实现内容审核
- 过滤敏感词汇
- 用户举报机制

---

## 总结

### 当前状态

**优势**：
- ✅ 核心AI功能完整
- ✅ 混元大模型集成稳定
- ✅ UI设计精美
- ✅ 云函数架构合理

**劣势**：
- ❌ 商业化功能全部缺失
- ❌ 用户体验不完整
- ❌ 无数据持久化

### 核心问题

1. **商业化基础缺失**：无次数限制、无广告系统
2. **用户体验不完整**：无历史记录、无对比功能
3. **实用性受限**：只能处理单段工作经历

### 建议行动

**立即行动（1-2周）**：
1. 实现用户登录系统
2. 实现次数限制机制
3. 集成激励视频广告
4. 实现历史记录功能

**短期规划（1周）**：
1. 实现优化前后对比
2. 实现多段工作经历处理
3. 实现撤销/重做功能
4. 实现保存草稿

**长期规划（2-4周）**：
1. 实现导出功能
2. 实现用户中心
3. 性能优化
4. 测试和发布

### 预期效果

完成第一和第二阶段后：
- 商业化闭环完成
- 用户体验大幅提升
- 产品从"能用"升级为"好用"
- 完成度从35%提升至80%+

完成所有规划后：
- 功能完整的简历优化工具
- 可商业化运营
- 有盈利能力
- 可扩展为完整简历生成平台

---

## 附录

### A. 参考文档

- [微信小程序官方文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [微信云开发文档](https://docs.cloudbase.net/)
- [腾讯混元大模型文档](https://hunyuan.tencent.com/)
- [微信广告文档](https://e.qq.com/dev/)

### B. 相关文件清单

**前端页面**：
- `F:\小程序\ai-resume\pages\index\index.js`
- `F:\小程序\ai-resume\pages\index\index.wxml`
- `F:\小程序\ai-resume\pages\index\index.wxss`

**云函数**：
- `F:\小程序\ai-resume\cloudfunctions\optimizeResume\index.js`
- `F:\小程序\ai-resume\cloudfunctions\generateExample\index.js`
- `F:\小程序\ai-resume\cloudfunctions\getCategories\index.js`
- `F:\小程序\ai-resume\cloudfunctions\saveCustomCategory\index.js`
- `F:\小程序\ai-resume\cloudfunctions\login\index.js`

**配置文件**：
- `F:\小程序\ai-resume\app.json`
- `F:\小程序\ai-resume\project.config.json`
- `F:\小程序\ai-resume\ROADMAP.md`

---

**文档维护者**：AI Assistant
**最后更新**：2026年2月6日
