# 快速配置指南 - 激励视频广告

> 文档生成时间：2026年2月6日
> 目标：3分钟完成广告配置

---

## 🔴 立即行动（必做）

### 步骤1：申请并创建广告位（5分钟）

1. **检查开通条件**
   - 登录微信小程序后台
   - 点击【推广与搜索】→【流量主】
   - 查看累计UV是否 ≥ 1000

2. **开通流量主功能**
   - 如果满足条件，点击【开通】
   - 等待1个工作日审核

3. **创建激励视频广告位**
   - 审核通过后，点击【广告位管理】
   - 点击【新建广告位】
   - 选择【激励视频广告】
   - 填写：
     - **广告位名称**：`首页激励视频`
     - **广告位描述**：`获取额外使用机会`

4. **获取广告单元ID**
   - 创建成功后，复制【广告单元ID】
   - 格式示例：`adunit-1234567890123456`

---

### 步骤2：配置代码（1分钟）

打开以下文件，找到广告单元ID配置位置：

**文件1**：`config/config.js`
```javascript
// 找到第39行，修改如下：
rewardedVideo: {
  development: '',  // 开发环境可以留空
  production: 'adunit-1234567890123456'  // ⚠️ 粘贴你的广告单元ID
}
```

**文件2**：`cloudfunctions/recordAdWatch/index.js`
- 此文件已自动从配置文件读取广告单元ID，无需修改

**文件3**：`pages/index/index.js`
- 此文件已自动从配置文件读取广告单元ID，无需修改

---

## ✅ 配置验证

### 验证1：检查配置文件

打开 `config/config.js`，确认：

- [ ] `production` 环境的广告单元ID已替换
- [ ] 广告单元ID格式正确（adunit-开头 + 16位数字）
- [ ] 共22位字符

### 验证2：上传云函数

在微信开发者工具中：

1. 右键 `cloudfunctions/recordAdWatch/`
2. 选择【上传并部署：云端安装依赖】
3. 等待上传完成

### 验证3：真机测试

1. 使用真机预览
2. 尝试使用AI优化功能
3. 免费次数用完时，点击观看广告
4. 查看控制台日志，确认广告是否加载成功

**预期结果**：
- ✅ 控制台显示：`[AD] 使用广告单元ID: adunit-...`
- ✅ 广告加载成功，显示激励视频
- ✅ 看完广告后，获得额外1次使用机会
- ✅ 次数显示正确

---

## 🐛 常见问题

### Q1：广告单元ID格式不对

**错误**：广告单元ID长度异常
**解决**：
1. 检查广告单元ID是否为 `adunit-` 开头
2. 检查后面是否为16位数字
3. 总共22位字符

### Q2：广告加载失败（错误码1002）

**原因**：广告单元ID错误或广告位未审核通过
**解决**：
1. 确认广告单元ID正确
2. 检查广告位审核状态（审核通过才能展示）
3. 等待1个工作日让审核完成

### Q3：广告加载失败（错误码1004）

**原因**：无适合的广告
**解决**：
1. 属于正常情况，可以隐藏广告按钮
2. 或引导用户登录获取更多机会

### Q4：广告加载失败（错误码1005/1006/1007）

**原因**：广告位审核中/不通过/被封禁
**解决**：
1. 登录微信小程序后台查看审核意见
2. 根据意见修改广告位配置
3. 重新提交审核

### Q5：开发者工具中无法预览广告

**原因**：广告需要在真机上预览
**解决**：
1. 使用真机调试功能
2. 或编译后体验版扫码测试

---

## 📞 技术支持

### 配置完成后仍有问题

1. **检查日志**：
   - 微信开发者工具 → 控制台
   - 查找 `[AD]` 开头的日志

2. **查看广告错误详情**：
   - 找到 `console.error('[AD] 广告加载失败', err)`
   - 查看 `err.errCode` 错误码

3. **参考错误码对照表**：
   - 查看完整错误码说明（在下方或广告配置指南文档中）

4. **联系微信客服**：
   - 商务问题：https://developers.weixin.qq.com/
   - 广告问题：https://kf.qq.com/

---

## 📋 配置检查清单

完成配置后，逐项检查：

### 开发前检查
- [ ] 累计UV ≥ 1000
- [ ] 已开通流量主功能
- [ ] 已创建激励视频广告位
- [ ] 已获取并记录广告单元ID

### 代码配置检查
- [ ] `config/config.js` 中已替换生产环境广告单元ID
- [ ] 云函数已上传到云端
- [ ] 广告单元ID格式正确（adunit-xxxx...）

### 功能测试检查
- [ ] 真机测试广告显示
- [ ] 测试完整观看广告后奖励发放
- [ ] 测试中途退出广告不给奖励
- [ ] 测试次数用完时引导看广告

### 错误处理检查
- [ ] 错误码1002有友好提示
- [ ] 错误码1004有降级方案
- [ ] 其他错误码有重试机制
- [ ] 所有错误都有日志记录

---

## 🎉 完成配置

完成以上所有检查后，你的小程序的激励视频广告功能就可以正常工作了！

**预期效果**：
- ✅ 用户可以免费使用3次
- ✅ 次数用完时可以看广告获取额外机会
- ✅ 每天最多10次（3免费+7广告）
- ✅ 24小时后自动重置
- ✅ 防刷机制保护

**下一步**：
- 开始推广小程序，提升UV和活跃度
- 监控广告收益数据
- 根据数据优化广告展示策略

---

**文档维护者**：AI Assistant
**最后更新**：2026年2月6日
